<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>OpenAPI 接口文档 on FastGPT</title><link>/docs/development/openapi/</link><description>Recent content in OpenAPI 接口文档 on FastGPT</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="/docs/development/openapi/index.xml" rel="self" type="application/rss+xml"/><item><title>Api Key 使用与鉴权</title><link>/docs/development/openapi/auth/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/development/openapi/auth/</guid><description>使用说明 linkFasGPT OpenAPI 接口允许你使用 Api Key 进行鉴权，从而操作 FastGPT 上的相关服务和资源，例如：调用应用对话接口、上传知识库数据、搜索测试等等。出于兼容性和安全考虑，并不是所有的接口都允许通过 Api Key 访问。
如何查看 BaseURL link注意：BaseURL 不是接口地址，而是所有接口的根地址，直接请求 BaseURL 是没有用的。
如何获取 Api Key linkFastGPT 的 API Key 有 2 类，一类是全局通用的 key (无法直接调用应用对话)；一类是携带了 AppId 也就是有应用标记的 key (可直接调用应用对话)。
我们建议，仅操作应用或者对话的相关接口使用 应用特定key，其他接口使用 通用key。
通用key 应用特定 key 基本配置 linkOpenAPI 中，所有的接口都通过 Header.Authorization 进行鉴权。
baseUrl: &amp;#34;https://api.fastgpt.in/api&amp;#34; headers: { Authorization: &amp;#34;Bearer {{apikey}}&amp;#34; } 发起应用对话示例
curl --location --request POST &amp;#39;https://api.fastgpt.in/api/v1/chat/completions&amp;#39; \ --header &amp;#39;Authorization: Bearer fastgpt-xxxxxx&amp;#39; \ --header &amp;#39;Content-Type: application/json&amp;#39; \ --data-raw &amp;#39;{ &amp;#34;chatId&amp;#34;: &amp;#34;111&amp;#34;, &amp;#34;stream&amp;#34;: false, &amp;#34;detail&amp;#34;: false, &amp;#34;messages&amp;#34;: [ { &amp;#34;content&amp;#34;: &amp;#34;导演是谁&amp;#34;, &amp;#34;role&amp;#34;: &amp;#34;user&amp;#34; } ] }&amp;#39;</description></item><item><title>对话接口</title><link>/docs/development/openapi/chat/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/development/openapi/chat/</guid><description>发起对话 link 🤖
该接口的 API Key 需使用应用特定的 key，否则会报错。
有些包调用时，BaseUrl需要添加v1路径，有些不需要，如果出现404情况，可补充v1重试。
对话接口兼容GPT的接口！如果你的项目使用的是标准的GPT官方接口，可以直接通过修改BaseUrl和 Authorization来访问 FastGpt 应用。
请求 link 请求示例 detail=true 响应 curl --location --request POST &amp;#39;https://api.fastgpt.in/api/v1/chat/completions&amp;#39; \ --header &amp;#39;Authorization: Bearer fastgpt-xxxxxx&amp;#39; \ --header &amp;#39;Content-Type: application/json&amp;#39; \ --data-raw &amp;#39;{ &amp;#34;chatId&amp;#34;: &amp;#34;abcd&amp;#34;, &amp;#34;stream&amp;#34;: false, &amp;#34;detail&amp;#34;: false, &amp;#34;variables&amp;#34;: { &amp;#34;uid&amp;#34;: &amp;#34;asdfadsfasfd2323&amp;#34;, &amp;#34;name&amp;#34;: &amp;#34;张三&amp;#34; }, &amp;#34;messages&amp;#34;: [ { &amp;#34;content&amp;#34;: &amp;#34;导演是谁&amp;#34;, &amp;#34;role&amp;#34;: &amp;#34;user&amp;#34; } ] }&amp;#39; info headers.Authorization: Bearer {{apikey}} chatId: string | undefined 。 为 undefined 时（不传入），不使用 FastGpt 提供的上下文功能，完全通过传入的 messages 构建上下文。 不会将你的记录存储到数据库中，你也无法在记录汇总中查阅到。 为非空字符串时，意味着使用 chatId 进行对话，自动从 FastGpt 数据库取历史记录，并使用 messages 数组最后一个内容作为用户问题。请自行确保 chatId 唯一，长度小于250，通常可以是自己系统的对话框ID。 messages: 结构与 GPT接口 完全一致。 detail: 是否返回中间值（模块状态，响应的完整结果等），stream模式下会通过event进行区分，非stream模式结果保存在responseData中。 variables: 模块变量，一个对象，会替换模块中，输入框内容里的{{key}} 响应 link detail=false,stream=false 响应 detail=false,stream=true 响应 detail=true,stream=false 响应 detail=true,stream=true 响应 { &amp;#34;id&amp;#34;: &amp;#34;adsfasf&amp;#34;, &amp;#34;model&amp;#34;: &amp;#34;&amp;#34;, &amp;#34;usage&amp;#34;: { &amp;#34;prompt_tokens&amp;#34;: 1, &amp;#34;completion_tokens&amp;#34;: 1, &amp;#34;total_tokens&amp;#34;: 1 }, &amp;#34;choices&amp;#34;: [ { &amp;#34;message&amp;#34;: { &amp;#34;role&amp;#34;: &amp;#34;assistant&amp;#34;, &amp;#34;content&amp;#34;: &amp;#34;电影《铃芽之旅》的导演是新海诚。&amp;#34; }, &amp;#34;finish_reason&amp;#34;: &amp;#34;stop&amp;#34;, &amp;#34;index&amp;#34;: 0 } ] } data: {&amp;#34;id&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;object&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;created&amp;#34;:0,&amp;#34;choices&amp;#34;:[{&amp;#34;delta&amp;#34;:{&amp;#34;content&amp;#34;:&amp;#34;&amp;#34;},&amp;#34;index&amp;#34;:0,&amp;#34;finish_reason&amp;#34;:null}]} data: {&amp;#34;id&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;object&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;created&amp;#34;:0,&amp;#34;choices&amp;#34;:[{&amp;#34;delta&amp;#34;:{&amp;#34;content&amp;#34;:&amp;#34;电&amp;#34;},&amp;#34;index&amp;#34;:0,&amp;#34;finish_reason&amp;#34;:null}]} data: {&amp;#34;id&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;object&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;created&amp;#34;:0,&amp;#34;choices&amp;#34;:[{&amp;#34;delta&amp;#34;:{&amp;#34;content&amp;#34;:&amp;#34;影&amp;#34;},&amp;#34;index&amp;#34;:0,&amp;#34;finish_reason&amp;#34;:null}]} data: {&amp;#34;id&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;object&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;created&amp;#34;:0,&amp;#34;choices&amp;#34;:[{&amp;#34;delta&amp;#34;:{&amp;#34;content&amp;#34;:&amp;#34;《&amp;#34;},&amp;#34;index&amp;#34;:0,&amp;#34;finish_reason&amp;#34;:null}]} { &amp;#34;responseData&amp;#34;: [ // 不同模块的响应值, 不同版本具体值可能有差异，可先 log 自行查看最新值。 { &amp;#34;moduleName&amp;#34;: &amp;#34;Dataset Search&amp;#34;, &amp;#34;price&amp;#34;: 1.</description></item><item><title>知识库接口</title><link>/docs/development/openapi/dataset/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/development/openapi/dataset/</guid><description>如何获取知识库ID（datasetId） 如何获取文件集合ID（collection_id） 创建训练订单 link请求示例
curl --location --request POST &amp;#39;https://api.fastgpt.in/api/support/wallet/bill/createTrainingBill&amp;#39; \ --header &amp;#39;Authorization: Bearer {{apikey}}&amp;#39; \ --header &amp;#39;Content-Type: application/json&amp;#39; \ --data-raw &amp;#39;{ &amp;#34;name&amp;#34;: &amp;#34;可选，自定义订单名称，例如：文档训练-fastgpt.docx&amp;#34; }&amp;#39; 响应结果
data 为 billId，可用于添加知识库数据时进行账单聚合。
{ &amp;#34;code&amp;#34;: 200, &amp;#34;statusText&amp;#34;: &amp;#34;&amp;#34;, &amp;#34;message&amp;#34;: &amp;#34;&amp;#34;, &amp;#34;data&amp;#34;: &amp;#34;65112ab717c32018f4156361&amp;#34; } 知识库添加数据 link 请求示例 参数说明 响应例子 QA Prompt 模板 curl --location --request POST &amp;#39;https://api.fastgpt.in/api/core/dataset/data/pushData&amp;#39; \ --header &amp;#39;Authorization: Bearer apikey&amp;#39; \ --header &amp;#39;Content-Type: application/json&amp;#39; \ --data-raw &amp;#39;{ &amp;#34;collectionId&amp;#34;: &amp;#34;64663f451ba1676dbdef0499&amp;#34;, &amp;#34;mode&amp;#34;: &amp;#34;chunk&amp;#34;, &amp;#34;prompt&amp;#34;: &amp;#34;可选。qa 拆分引导词，chunk 模式下忽略&amp;#34;, &amp;#34;billId&amp;#34;: &amp;#34;可选。如果有这个值，本次的数据会被聚合到一个订单中，这个值可以重复使用。可以参考 [创建训练订单] 获取该值。&amp;#34;, &amp;#34;data&amp;#34;: [ { &amp;#34;q&amp;#34;: &amp;#34;你是谁？&amp;#34;, &amp;#34;a&amp;#34;: &amp;#34;我是FastGPT助手&amp;#34; }, { &amp;#34;q&amp;#34;: &amp;#34;你会什么？&amp;#34;, &amp;#34;a&amp;#34;: &amp;#34;我什么都会&amp;#34;, &amp;#34;indexes&amp;#34;: [{ &amp;#34;type&amp;#34;:&amp;#34;custom&amp;#34;, &amp;#34;text&amp;#34;:&amp;#34;你好&amp;#34; }] } ] }&amp;#39; 需要先了解 FastGPT 的多路索引概念：</description></item><item><title>分享链接身份鉴权</title><link>/docs/development/openapi/share/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/development/openapi/share/</guid><description>介绍 link在 FastGPT V4.6.4 中，我们修改了分享链接的数据读取方式，为每个用户生成一个 localId，用于标识用户，从云端拉取对话记录。但是这种方式仅能保障用户在同一设备同一浏览器中使用，如果切换设备或者清空浏览器缓存则会丢失这些记录。这种方式存在一定的风险，因此我们仅允许用户拉取近30天的20条记录。
分享链接身份鉴权设计的目的在于，将 FastGPT 的对话框快速、安全的接入到你现有的系统中，仅需 2 个接口即可实现。
使用说明 link免登录链接配置中，你可以选择填写身份验证栏。这是一个POST请求的根地址。在填写该地址后，分享链接的初始化、开始对话以及对话结束都会向该地址的特定接口发送一条请求。下面以host来表示凭身份验证根地址。服务器接口仅需返回是否校验成功即可，不需要返回其他数据，格式如下：
接口统一响应格式 link { &amp;#34;success&amp;#34;: true, &amp;#34;message&amp;#34;: &amp;#34;错误提示&amp;#34;, &amp;#34;msg&amp;#34;: &amp;#34;同message, 错误提示&amp;#34;, &amp;#34;data&amp;#34;: { &amp;#34;uid&amp;#34;: &amp;#34;用户唯一凭证&amp;#34; } } FastGPT 将会判断success是否为true决定是允许用户继续操作。message与msg是等同的，你可以选择返回其中一个，当success不为true时，将会提示这个错误。
uid是用户的唯一凭证，将会用于拉取对话记录以及保存对话记录。可参考下方实践案例。
触发流程 link 配置教程 link1. 配置身份校验地址 link 配置校验地址后，在每次分享链接使用时，都会向对应的地址发起校验和上报请求。
🤖
这里仅需配置根地址，无需具体到完整请求路径。
2. 分享链接中增加额外 query link在分享链接的地址中，增加一个额外的参数: authToken。例如：
原始的链接：https://share.fastgpt.in/chat/share?shareId=648aaf5ae121349a16d62192
完整链接: https://share.fastgpt.in/chat/share?shareId=648aaf5ae121349a16d62192&amp;amp;authToken=userid12345
这个authToken通常是你系统生成的用户唯一凭证（Token之类的）。FastGPT 会在鉴权接口的body中携带 token={{authToken}} 的参数。
3. 编写聊天初始化校验接口 link 请求示例 鉴权成功 鉴权失败 curl --location --request POST &amp;#39;{{host}}/shareAuth/init&amp;#39; \ --header &amp;#39;Content-Type: application/json&amp;#39; \ --data-raw &amp;#39;{ &amp;#34;token&amp;#34;: &amp;#34;{{authToken}}&amp;#34; }&amp;#39; { &amp;#34;success&amp;#34;: true, &amp;#34;data&amp;#34;: { &amp;#34;uid&amp;#34;: &amp;#34;用户唯一凭证&amp;#34; } } 系统会拉取该分享链接下，uid 为 username123 的对话记录。</description></item></channel></rss>